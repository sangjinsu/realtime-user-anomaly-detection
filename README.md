# 서버 액세스 로그 기반 유저 이상행동 감지 시스템 구축

### 📘 시나리오

운영자는 아래와 같은 문제를 해결하고 싶어합니다:

> “게임 내 유저가 짧은 시간 안에 반복적인 로그인, 보상 요청, 퀘스트 수령 등을 반복 수행할 경우 의심스러운 행동으로 간주하여 자동으로 경고를 주고 싶습니다. 또한 운영자나 감사자는 이런 행동들을 추적할 수
> 있어야 하고, 필요시 수동 제재도 가능해야 합니다.”

### 🧱 시스템 구성

서비스는 다음과 같은 MSA 구조로 NestJS + MongoDB + Docker 환경에서 구성합니다

| 서비스     | 역할                             |
|---------|--------------------------------|
| Gateway | 모든 요청 진입점. 인증(JWT), 역할 검사, 라우팅 |
| Auth    | 유저 정보 관리, 로그인, JWT 발급 및 역할 분리  |
| Monitor | 유저 행동 로그 수집 및 이상행동 감지          |
| Admin   | 경고 이력 관리, 수동 제재 도구             |

### 🔧 개발 요구사항
#### ✅ 1. 기본 구조 구축
- NestJS Monorepo 기반 프로젝트 생성
- Docker 및 docker-compose 구성
- MongoDB 연동
- 각 서비스는 TCP 통신 방식 사용

✅ 2. 인증 및 유저 관리 (Auth)
- 유저 회원가입 및 로그인 API
- JWT 발급 및 검증
- 역할: USER, OPERATOR, ADMIN
- @RolesGuard 를 통한 인증 및 인가 구현

✅ 3. Gateway
- JWT 인증 필터
- 역할별 접근 제한
- 서비스별 라우팅 Proxy 설정

✅ 4. 유저 행동 로그 수집 (Monitor)
- 로그 생성 API (POST /logs)
- 요청 body: userId, action, metadata, timestamp
  - 예: 로그인, 보상 요청, 퀘스트 수령
- 로그 저장 구조 정의 및 MongoDB 저장

✅ 5. 이상 행동 감지
- 간단한 정책 기반 감지 구현
  - 5분 내 로그인 10회 이상
  - 같은 아이템 보상 연속 요청 10회 이상
- 이상행동 발생 시 warnings 컬렉션에 기록
- 자동 차단 여부 필드 포함 (autoBlocked: boolean)
- 전략 패턴 혹은 유사한 방식으로 정책 구성 (확장 고려)

✅ 6. 이력 조회 API
- 유저: GET /warnings/me
- 관리자: GET /warnings (필터링 포함: 유저ID, 시간, 종류 등)
