# ✅ SDLC 1단계: 요구사항 정의

## 🎯 프로젝트 개요

**목표:**
유저의 행동 로그를 수집하고, 운영자가 정의한 기준에 따라 이상행동을 자동 감지하여 경고를 생성하는 백엔드 시스템을 구축한다.

## 🧩 핵심 기능 요약

| 기능       | 설명                                       |
| -------- | ---------------------------------------- |
| 유저 인증    | 회원가입, 로그인, JWT 발급                        |
| 유저 권한 분리 | `USER`, `OPERATOR`, `ADMIN` 등의 역할별 기능 제한 |
| 행동 로그 수집 | 유저가 수행하는 주요 액션(로그인, 보상 요청 등)을 기록         |
| 이상행동 탐지  | 정의된 규칙에 따라 이상행동 여부 판단 후 경고 생성            |
| 경고 이력 조회 | 유저 본인 또는 운영자/관리자가 경고 기록 조회 가능            |

---

## 👥 사용자 유형 및 요구사항

### 1. 일반 유저 (`USER`)

* 로그인을 통해 인증받고 서비스를 이용한다.
* 자신이 발생시킨 이상행동 경고 이력을 조회할 수 있다.

### 2. 운영자 (`OPERATOR`)

* 전체 유저의 행동 로그를 열람할 수 있다.
* 이상행동 탐지 정책을 관리할 수 있다 (보너스 기능).
* 경고 이력을 필터링하여 조회한다.

### 3. 관리자 (`ADMIN`)

* 운영자 기능 포함 + 유저 차단 등 제재 기능 (선택 구현).
* 모든 데이터에 대한 조회 권한을 가진다.

---

## 📚 기능별 상세 요구사항

### 🔐 인증/인가

* 유저는 이메일/비밀번호로 회원가입 및 로그인한다.
* JWT를 이용하여 API 인증을 수행한다.
* 모든 API는 `@RolesGuard` 를 통해 역할 검사를 진행한다.

---

### 📝 행동 로그 기록

* 유저 행동은 로그로 저장되며, 최소한 다음 필드를 포함한다:

   * `userId`, `action`, `timestamp`, `metadata` (선택)
* 예시 액션: `LOGIN`, `CLAIM_REWARD`, `COMPLETE_QUEST`

---

### 🚨 이상행동 감지

* 다음 조건 중 하나 이상을 만족하면 경고가 생성된다.

   * 5분 내 로그인 10회 이상
   * 동일 보상 요청 5회 이상 (짧은 시간에)
* 조건은 고정된 rule-based 방식으로 구현한다.
* 조건 만족 시 `warnings` 컬렉션에 경고 생성

   * `userId`, `reason`, `timestamp`, `autoBlocked`

---

### 📈 경고 이력 조회

* 유저는 자신의 경고 이력을 조회할 수 있어야 한다 (`/warnings/me`)
* 운영자는 모든 유저의 경고 이력을 조회할 수 있다 (`/warnings`)

   * 필터링: userId, 시간 범위, 행동 종류 등

---

## 🚫 제약사항 및 비기능 요구사항

* 프론트엔드 UI는 필요하지 않다 (Insomnia 등으로 테스트)
* 동시 요청에도 안전해야 한다 (로그 중복 저장 방지 등)
* API 응답 속도는 1초 이내를 유지
* MongoDB 기반으로 데이터 처리 (Aggregation 활용 가능)
* 도커 기반으로 실행 가능한 환경 제공

---

## 🧪 테스트 범위

* 인증 흐름 테스트
* 로그 기록 및 경고 생성 조건 테스트
* 역할별 API 접근 제어 테스트
